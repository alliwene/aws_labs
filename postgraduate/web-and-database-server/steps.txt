- Create key pair 
	aws ec2 create-key-pair --key-name mykey --query 'KeyMaterial' --output text > mykey.pem

- Add database password to systems manager parameter store
	aws ssm put-parameter --name dbPassword --type String --value "<password>"

# Dynamic ssm parameter in cloudformation
	'{{resolve:ssm-secure:dbPassword:1}}' 

- Create stack
	aws cloudformation create-stack \
	--stack-name db-stack \
	--template-body file://formation.yml \
	--disable-rollback 

- Track create progress 
	watch -n 5 -d \
	aws cloudformation describe-stack-resources \
	--stack-name db-stack \
	--query 'StackResources[*].[ResourceType,ResourceStatus]' \
	--output table 

- Check resources that failed to create
	aws cloudformation describe-stack-events \
	--stack-name db-stack \
	--query "StackEvents[?ResourceStatus == 'CREATE_FAILED']" 

- Update stack
	aws cloudformation update-stack \
	--stack-name db-stack \
	--template-body file://formation.yml \
	--disable-rollback 

- Delete stack 
	aws cloudformation delete-stack \
	--stack-name db-stack 

- Get rds endpoint 
	aws rds describe-db-instances \
	--db-instance-identifier tutorial-db-instance \
	--query 'DBInstances[0].Endpoint.Address' 

- Get EC2 public ip
	aws ec2 describe-instances \
	--query "Reservations[*].Instances[*].PublicIpAddress" \
	--output text 


scp -i ~/Documents/Keys/mykey.pem dbinfo.inc ec2-user@52.13.46.5:/var/www/inc/dbinfo.inc
scp -i ~/Documents/Keys/mykey.pem SamplePage.php ec2-user@52.13.46.5:/var/www/html/SamplePage.php


###########################################
- Add secrets manager secret 
	aws secretsmanager create-secret \
	--name myRDSSecret \
	--description "rds instance secret" \
	--secret-string file://oauth.json 

- Dynamic secrets manager parameter 
	MasterUsername: '{{resolve:secretsmanager:MyRDSSecret:SecretString:username}}'
	MasterUserPassword: '{{resolve:secretsmanager:MyRDSSecret:SecretString:password}}'

- Delete secret
	aws secretsmanager delete-secret --secret-id myRDSSecret --force-delete-without-recovery

- Remove deletion protection from rds instance 
	aws rds modify-db-instance --db-instance-identifier <identifier> --no-deletion-protection 




